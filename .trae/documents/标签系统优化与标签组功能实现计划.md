## 一、搜索组件重构

### 1.1 精确设计要求
- **位置**：右上角，切换排序模式按钮的左边，与其他按钮对齐
- **展开方向**：朝左边张开，盖住"标签管理"文字标题
- **文字标签动画**：根据搜索栏张开/收起有淡入淡出动画
- **不影响现有按钮**：保留切换排序和重置按钮的位置和逻辑

### 1.2 实现方案
- **搜索按钮**：放大镜图标，与现有按钮组对齐
- **展开动画**：点击后向左展开搜索框，覆盖标题文字
- **状态管理**：
  - 有内容时保持展开
  - 内容为空时收缩为图标按钮
  - 标题文字随搜索框展开淡入淡出
- **交互**：点击展开并唤起输入法，点击外部关闭

### 1.3 实现步骤
1. 创建`ExpandableSearchButton`组件
2. 集成到现有按钮组，位于切换排序按钮左侧
3. 实现向左展开的搜索框
4. 添加标题文字的淡入淡出动画
5. 实现状态管理和流畅动画

## 二、标签组功能实现

### 2.1 数据模型
- **TagGroup实体**：id, name, isDefault, sortOrder, tagIds
- "未分组"组：代码层面实现，不保存到配置文件

### 2.2 导航栏设计
- **扁平简约风格**，高度适中
- **可左右滑动**，右侧按钮固定
- 按钮布局：
  - 左侧："新建标签组"按钮
  - 右侧：管理按钮（"<"形状，点击旋转为"V"，打开叠加层）
- 叠加层：平铺显示更多标签组，所有按钮大小一致

### 2.3 交互逻辑
- **单击**：切换至该组视图，仅显示当前组标签
- **双击**：打开编辑页面
- **编辑页面布局**：
  - 顶部：当前组名称
  - 中间：标签选择区，带搜索过滤栏
  - 底部：保存和取消按钮

- **拖拽排序**：
  - 仅在管理页面支持
  - 长按1.5秒进入拖拽模式
  - 视觉反馈：其他组自动规避，靠近边缘自动滚动
  - 不干扰正常上下滑动

### 2.4 "未分组"组特殊处理
- 不可编辑或重命名
- 可调整排序
- 包含所有未分配标签
- 代码层面实现，不保存到配置文件

### 2.5 标签多组归属
- 支持一个标签同时属于多个组
- 实现标签组关联管理

## 三、同步更新标签选择页面

### 3.1 实现内容
- 添加标签组导航栏
- 同步标签组选择逻辑
- 保持与标签抽屉的一致性

### 3.2 实现步骤
1. 修改`TagSelectionScreen`
2. 添加标签组导航
3. 同步状态管理

## 四、搜索功能优化

### 4.1 跨组搜索
- 搜索时显示所有匹配标签，不受当前组限制

### 4.2 结果排序
- 当前组匹配标签优先显示
- 其他组匹配标签靠后显示

## 五、文件结构调整

### 5.1 新增文件
- `ExpandableSearchButton.kt`
- `TagGroupNavBar.kt`
- `TagGroupEditDialog.kt`
- `TagGroupManagementPage.kt`
- `TagGroup.kt`
- `TagGroupRepository.kt`

### 5.2 修改文件
- `TagManagerDrawer.kt`
- `TagManagerHeader.kt`
- `TagSelectionScreen.kt`

## 六、技术要点

1. **搜索组件**：使用`AnimatedVisibility`实现向左展开
2. **标题动画**：使用`animateFloatAsState`实现淡入淡出
3. **导航栏**：`LazyRow` + 固定定位
4. **拖拽排序**：`Modifier.draggable` + 流畅动画
5. **状态管理**：`remember` + `derivedStateOf`
6. **数据持久化**：`ConfigManager`

## 七、测试重点

1. 搜索组件展开方向和动画
2. 标题文字淡入淡出效果
3. 不影响现有按钮功能
4. 标签组切换和编辑
5. 拖拽排序流畅性
6. 跨组搜索功能
7. 各种屏幕尺寸适配

## 八、设计规范

- 严格按照用户要求实现搜索组件位置和展开方向
- 保持现有UI设计风格一致性
- 提供流畅的动画效果
- 支持各种屏幕尺寸
- 确保无障碍访问

这个计划精确实现了用户的所有要求，包括搜索组件的位置、展开方向、标题动画，以及标签组功能的完整实现。