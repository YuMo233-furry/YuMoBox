# 标签组数据外部存储实现计划

## 问题分析
当前标签组数据存储在Room数据库中，而用户希望标签组数据能够像标签一样存储到外部公共文件夹中，使用配置文件的方式。这样可以方便用户查看和管理标签组数据。

## 设计思路
1. 参考`TagFileManager`类，设计一个类似的`TagGroupFileManager`类来管理标签组数据的文件存储
2. 将标签组数据存储在`YuMoBox/tag_groups`目录下，使用JSON格式
3. 每个标签组存储为一个JSON文件，命名为`group_<groupId>.json`
4. 标签组与标签的关联关系可以存储在标签组的JSON文件中
5. 修改现有代码，使用文件系统而不是数据库来管理标签组数据

## 实现步骤

### 1. 创建标签组数据模型类
- 创建`TagGroupData`类，用于表示标签组数据，包含标签组的基本信息和关联的标签ID列表
- 确保该类适合JSON序列化和反序列化

### 2. 实现`TagGroupFileManager`类
- 参考`TagFileManager`类，实现标签组数据的文件读写功能
- 实现`readTagGroup`、`writeTagGroup`、`deleteTagGroup`、`getAllTagGroups`等方法
- 使用Moshi进行JSON序列化和反序列化
- 实现标签组数据的缓存机制
- 实现标签组变化通知机制

### 3. 修改`TagViewModelNew`类
- 替换数据库操作，使用`TagGroupFileManager`来管理标签组数据
- 修改`createTagGroup`、`renameTagGroup`、`deleteTagGroup`、`addTagToTagGroup`、`removeTagFromTagGroup`等方法
- 确保标签组数据的增删改查都通过文件系统进行

### 4. 修改标签组数据流
- 将`tagGroupsFlow`从数据库查询替换为从文件系统读取
- 实现标签组数据的实时更新机制

### 5. 移除相关数据库代码
- 移除`TagGroupEntity`和`TagGroupTagCrossRef`的数据库注解
- 移除相关的数据库迁移代码
- 简化数据库实体类，只保留数据模型功能

## 预期效果
- 标签组数据存储在外部公共文件夹`YuMoBox/tag_groups`中
- 每个标签组存储为一个JSON文件
- 标签组与标签的关联关系存储在标签组的JSON文件中
- 标签组数据的增删改查通过文件系统进行
- 标签组数据的更新能够实时反映到UI上

## 技术要点
- 使用Moshi进行JSON序列化和反序列化
- 实现文件缓存机制，提高性能
- 实现标签组变化通知机制
- 确保文件操作的线程安全性
- 确保与现有标签系统的兼容性

## 注意事项
- 确保应用具有读写外部存储的权限
- 处理文件读写异常
- 确保标签组ID的唯一性
- 实现数据迁移，将现有数据库中的标签组数据迁移到文件系统中

## 实现文件
- `TagGroupData.kt`：标签组数据模型类
- `TagGroupFileManager.kt`：标签组数据文件管理类
- `TagViewModelNew.kt`：修改标签组管理逻辑
- `TagGroupEntities.kt`：简化数据库实体类
- `AppDatabase.kt`：移除相关数据库代码

## 测试计划
- 测试标签组的创建、编辑、删除功能
- 测试标签组与标签的关联关系管理
- 测试标签组数据的文件存储和加载
- 测试标签组数据的实时更新
- 测试数据迁移功能

通过以上实现，标签组数据将能够像标签一样存储到外部公共文件夹中，方便用户查看和管理。