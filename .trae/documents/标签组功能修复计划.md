# 标签组功能修复计划

## 问题分析
1. **标签组编辑选择标签后保存失败**：可能是标签关联更新逻辑存在问题
2. **下次打开标签全部未勾选**：与第一个问题相关，标签关联未保存成功
3. **选择标签组标签没有过滤**：`getTagsByTagGroupId`方法未实现真实的过滤逻辑
4. **公共文件夹没有看到标签组文件夹**：标签组数据存储在Room数据库中，而非文件系统

## 修复方案

### 1. 修复标签组编辑保存逻辑
- **文件**：`TagGroupNavigationBar.kt`
- **问题**：标签组编辑保存时，标签关联更新可能未正确执行
- **修复**：检查并优化标签关联更新逻辑，确保添加和移除标签的操作正确执行

### 2. 修复标签组过滤逻辑
- **文件**：`MainViewModel.kt`
- **问题**：`getTagsByTagGroupId`方法返回所有标签，未根据标签组ID过滤
- **修复**：实现真实的标签组过滤逻辑，根据标签组ID查询数据库获取对应标签

### 3. 优化标签组编辑UI
- **文件**：`TagGroupNavigationBar.kt`
- **问题**：确保标签组编辑对话框中的标签选择状态正确加载和保存
- **修复**：优化标签选择状态的加载和保存逻辑

### 4. 添加数据库操作异常处理
- **文件**：`TagViewModelNew.kt`
- **问题**：数据库操作可能出现异常，导致标签关联保存失败
- **修复**：添加更详细的异常日志和错误提示

## 实现步骤

1. 修复`MainViewModel.kt`中的`getTagsByTagGroupId`方法，实现真实的标签组过滤逻辑
2. 优化`TagGroupNavigationBar.kt`中的标签组编辑保存逻辑，确保标签关联正确更新
3. 添加更详细的异常日志和错误提示，便于调试
4. 测试标签组编辑保存功能，确保标签关联正确保存和加载
5. 测试标签组过滤功能，确保选择标签组后只显示对应标签

## 预期效果
- 标签组编辑选择标签后，点击保存能正确保存标签关联
- 下次打开标签组编辑对话框时，标签选择状态正确显示
- 选择标签组后，只显示该标签组下的标签
- 提供清晰的错误提示，便于用户了解操作结果

## 技术要点
- 使用Room数据库进行标签组和标签关联的CRUD操作
- 优化协程操作，确保数据库操作在后台线程执行
- 添加详细的日志记录，便于调试和错误追踪
- 确保UI状态与数据库状态同步