# 标签组功能修复与完善计划

## 一、需求澄清

根据您的反馈，我需要：
1. **仅保留"未分组"默认标签**：移除多余的默认标签
2. **正确实现未选中功能**：重复点击已选中标签可进入未选择状态，此时显示所有标签
3. **严格按照计划文档**实现其他标签组功能

## 二、修复与完善步骤

### 1. 数据模型修复

**目标**：仅保留"未分组"默认标签

**实现**：
- 修改标签组初始化逻辑，确保仅创建"未分组"标签组
- 移除多余的默认标签组
- 确保"未分组"标签组不可编辑或重命名

**文件修改**：
- `TagGroupEntities.kt`：调整数据模型
- `TagViewModelNew.kt`：修复初始化逻辑

### 2. 未选中功能正确实现

**目标**：重复点击已选中标签进入未选择状态，显示所有标签

**实现**：
- 在`TagGroupNavigationBar.kt`中实现标签组点击逻辑
- 当点击已选中标签组时，切换到未选择状态
- 未选择状态下显示所有标签
- 保存状态到`TagState`

**文件修改**：
- `TagGroupNavigationBar.kt`：实现未选中逻辑
- `TagState.kt`：添加未选中状态管理
- `TagManagerDrawer.kt`：适配未选中状态

### 3. 标签组导航栏完善

**目标**：严格按照文档实现扁平简约风格的标签组导航栏

**实现**：
- 可左右滑动的标签组列表
- 右侧固定的"新建标签组"和"管理"按钮
- 管理按钮点击后旋转并显示叠加层
- 叠加层平铺显示更多标签组

**文件修改**：
- `TagGroupNavigationBar.kt`：完善导航栏UI和交互

### 4. 标签多组归属实现

**目标**：支持一个标签同时属于多个组

**实现**：
- 实现标签组关联管理
- 确保标签可以同时归属于多个组

**文件修改**：
- `TagViewModelNew.kt`：添加多组归属逻辑
- `TagDao.kt`：调整数据库操作

### 5. 同步更新标签选择页面

**目标**：同步标签组功能到标签选择页面

**实现**：
- 添加标签组导航栏
- 同步未选中功能
- 保持与标签抽屉的一致性

**文件修改**：
- `TagSelectionScreen.kt`：添加标签组导航和未选中功能

### 6. 搜索功能优化

**目标**：实现跨组搜索和结果排序

**实现**：
- 搜索时显示所有匹配标签，不受当前组限制
- 当前组匹配标签优先显示
- 其他组匹配标签靠后显示

**文件修改**：
- `TagManagerDrawer.kt`：优化搜索逻辑
- `TagSelectionScreen.kt`：同步搜索优化

## 三、测试重点

1. 仅保留"未分组"默认标签
2. 未选中功能正常工作
3. 导航栏样式和交互符合设计要求
4. 标签多组归属功能正常
5. 跨组搜索和结果排序正确
6. 各种屏幕尺寸适配

## 四、文件结构

**修改文件**：
- `TagGroupEntities.kt`：修复数据模型
- `TagGroupNavigationBar.kt`：完善导航栏和未选中功能
- `TagState.kt`：添加未选中状态
- `TagViewModelNew.kt`：修复初始化和添加多组归属
- `TagManagerDrawer.kt`：适配未选中状态
- `TagSelectionScreen.kt`：同步标签组功能

## 五、技术要点

1. **状态管理**：正确管理选中/未选中状态
2. **导航栏实现**：LazyRow + 固定定位
3. **动画效果**：平滑的旋转和展开动画
4. **数据持久化**：确保标签组状态正确保存
5. **搜索优化**：跨组搜索算法

## 六、开发原则

1. 严格按照文档计划实现
2. 仅保留"未分组"默认标签
3. 正确实现未选中功能
4. 保持代码简洁，符合Kotlin和Compose最佳实践
5. 确保用户体验流畅

通过以上步骤，我将修复当前实现问题，并严格按照计划文档完善标签组功能，确保符合您的所有要求。